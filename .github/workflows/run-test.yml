name: Run Spotify Test

on:
  workflow_dispatch:
  push:
    paths:
      - 'test_1000_fast.py'
      - 'spotify_enhancer.py'

jobs:
  test-spotify-enhancer:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
        
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install requests pandas
        
    - name: Run fast test
      run: |
        echo "ğŸš€ Starting Spotify Fast Test..."
        python test_1000_fast.py
        
    - name: Check results
      run: |
        echo "ğŸ“Š Checking test results..."
        if [ -f "enhanced_test_1000_features_only.csv" ]; then
          echo "âœ… Output file created successfully"
          echo "ğŸ“ File size: $(du -h enhanced_test_1000_features_only.csv | cut -f1)"
          echo "ğŸ“Š Lines: $(wc -l < enhanced_test_1000_features_only.csv)"
          echo "ğŸ” First few lines of output:"
          head -5 enhanced_test_1000_features_only.csv
        else
          echo "âŒ Output file not found"
          exit 1
        fi
        
    - name: Upload results
      uses: actions/upload-artifact@v3
      with:
        name: enhanced-test-results
        path: |
          enhanced_test_1000_features_only.csv
          test_tracks_1000_features_only.csv
